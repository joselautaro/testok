<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Usuarios</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; background:#f6f7f9; }
    .top { display:flex; justify-content: space-between; align-items:center; gap: 12px; }
    .btn { padding:10px 14px; background:#111; color:#fff; text-decoration:none; border-radius:8px; display:inline-block; }
    table { width:100%; border-collapse: collapse; margin-top: 16px; background:#fff; border-radius: 12px; overflow:hidden; }
    th, td { padding: 12px; border-bottom: 1px solid #eee; text-align:left; vertical-align: middle; }
    th { background:#f5f5f5; }
    .role { font-weight: 800; }

    .actions { display:flex; gap:10px; flex-wrap: wrap; }
    .btn-sm { padding:8px 10px; border-radius:8px; text-decoration:none; display:inline-block; font-size: 14px; }

    .btn-edit { background:#0d6efd; color:#fff; }
    .btn-del  { background:#dc3545; color:#fff; border:none; cursor:pointer; }

    #toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      min-width: 260px;
      max-width: 340px;
      padding: 14px 18px;
      border-radius: 12px;
      font-size: 14px;
      color: #111;
      background: #fff;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      border-left: 6px solid;
      animation: slideIn .3s ease, fadeOut .3s ease 2.7s forwards;
    }

    .toast.success { border-color: #2ecc71; }
    .toast.error   { border-color: #e74c3c; }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(20px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    @keyframes fadeOut {
      to { opacity: 0; transform: translateX(20px); }
    }
  </style>
</head>
<body>

<div id="toast-container">
  <div class="toast success" th:if="${ok}" th:text="${ok}"></div>
  <div class="toast error" th:if="${err}" th:text="${err}"></div>
</div>

<div class="top">
  <!-- ✅ Título distinto según rol -->
  <h1 th:text="${esSuperAdmin} ? 'Usuarios (Admins y Clientes)' : 'Clientes'">Usuarios</h1>

  <div style="display:flex; gap:10px;">

    <!-- ✅ (Opcional) Botón SOLO para SUPERADMIN -->
    <!-- Si NO lo querés, borrá este bloque -->
    <a class="btn"
   sec:authorize="hasRole('SUPERADMIN')"
   th:href="@{/admin/usuarios}">
  Ver usuarios administradores
</a>



    <!-- ✅ Recomendado: solo SUPERADMIN crea usuarios -->
    <a class="btn"
       th:if="${esSuperAdmin}"
       th:href="@{/admin/usuarios/nuevo}">
      + Nuevo usuario
    </a>

    <a class="btn" th:href="@{/admin/clientes}">Volver</a>
  </div>
</div>

<table>
  <thead>
  <tr>
    <th>Username</th>
    <th>Rol</th>
    <th>Acciones</th>
  </tr>
  </thead>

  <tbody>
  <tr th:if="${#lists.isEmpty(usuarios)}">
    <td colspan="3">No hay usuarios.</td>
  </tr>

  <tr th:each="u : ${usuarios}">
    <td th:text="${u.username}">user</td>
    <td class="role" th:text="${u.rol}">ADMIN</td>

    <td>
      <div class="actions">

        <a class="btn-sm btn-edit"
           th:href="@{/admin/usuarios/{id}/editar(id=${u.id})}">
          Editar
        </a>

        <!-- ✅ Eliminar: solo SUPERADMIN -->
        <form th:if="${esSuperAdmin}"
              th:action="@{/admin/usuarios/{id}/eliminar(id=${u.id})}"
              method="post"
              style="margin:0;"
              onsubmit="return confirm('¿Seguro que querés eliminar este usuario?');">
          <button type="submit" class="btn-sm btn-del">Eliminar</button>
        </form>

      </div>
    </td>
  </tr>
  </tbody>
</table>

<script>
  setTimeout(() => {
    document.querySelectorAll('.toast').forEach(t => t.remove());
  }, 3000);
</script>

</body>
</html>
